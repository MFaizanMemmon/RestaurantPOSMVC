@{
    ViewData["Title"] = "POS";
}

<div class="mt-4">
    <h1 class="mb-4">Restaurant POS</h1>

    <div class="row mb-3">
        <div class="col-md-4">
            <label for="selectTable" class="form-label">Select Table:</label>
            <select id="selectTable" class="form-select">
                <option value="">Select Table</option>
                @for (int i = 1; i <= 20; i++)
                {
                    <option value="@i">Table @i</option>
                }
            </select>
        </div>

        <div class="col-md-4">
            <label for="selectCategory" class="form-label">Filter by Category:</label>
            <select id="selectCategory" class="form-select">
                <option value="All">All</option>
                <option>Appetizer</option>
                <option>Main Course</option>
                <option>Dessert</option>
                <option>Beverages</option>
                <option>Salads</option>
            </select>
        </div>
    </div>

    <div class="row">
        <!-- Menu items -->
        <div class="col-md-8">
            <div id="menuItems" class="row row-cols-1 row-cols-md-3 g-3">
                <script>
                    const products = [];
                    const categories = ["Appetizer", "Main Course", "Dessert", "Beverages", "Salads"];
                    for (let i = 1; i <= 30; i++) {
                        const category = categories[Math.floor(Math.random() * categories.length)];
                        const price = (Math.floor(Math.random() * 500) + 50).toFixed(2);
                        const product = {
                            id: i,
                            name: `Menu ${i}`,
                            category: category,
                            price: price,
                            img: "https://via.placeholder.com/80"
                        };
                        products.push(product);

                        document.write(`
                            <div class="col menu-item" data-category="${category}">
                                <div class="card h-100 text-center">
                                    <img src="${product.img}" class="card-img-top" alt="${product.name}">
                                    <div class="card-body">
                                        <h6 class="card-title">${product.name}</h6>
                                        <p>$${product.price}</p>
                                        <button class="btn btn-primary btn-sm w-100" onclick="addToCart(${i})">Add</button>
                                    </div>
                                </div>
                            </div>
                        `);
                    }
                </script>
            </div>
        </div>

        <!-- Cart / Order Summary -->
        <div class="col-md-4">
            <h5>Order Summary</h5>
            <table class="table table-bordered" id="cartTable">
                <thead class="table-secondary">
                    <tr>
                        <th>Item</th>
                        <th>Qty</th>
                        <th>Price</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <div class="d-flex justify-content-between mb-2">
                <strong>Total:</strong>
                <span id="totalAmount">$0.00</span>
            </div>
            <button class="btn btn-success w-100" onclick="placeOrder()">Place Order</button>
        </div>
    </div>
</div>

@section scripts {
    <script>
        let cart = [];

        // Add item to cart
        function addToCart(id) {
            const product = products.find(p => p.id === id);
            const cartItem = cart.find(c => c.id === id);

            if (cartItem) {
                cartItem.qty++;
            } else {
                cart.push({ ...product, qty: 1 });
            }
            renderCart();
        }

        // Remove item from cart
        function removeFromCart(id) {
            cart = cart.filter(c => c.id !== id);
            renderCart();
        }

        // Render cart table
        function renderCart() {
            const tbody = document.querySelector("#cartTable tbody");
            tbody.innerHTML = "";
            let total = 0;
            cart.forEach(item => {
                total += item.qty * item.price;
                tbody.innerHTML += `
                    <tr>
                        <td>${item.name}</td>
                        <td>${item.qty}</td>
                        <td>$${(item.qty * item.price).toFixed(2)}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="removeFromCart(${item.id})">Remove</button>
                        </td>
                    </tr>
                `;
            });
            document.getElementById("totalAmount").innerText = `$${total.toFixed(2)}`;
        }

        // Filter menu by category
        document.getElementById("selectCategory").addEventListener("change", function() {
            const selected = this.value;
            document.querySelectorAll(".menu-item").forEach(item => {
                if (selected === "All" || item.dataset.category === selected) {
                    item.style.display = "block";
                } else {
                    item.style.display = "none";
                }
            });
        });

        // Place Order
        function placeOrder() {
            if (!document.getElementById("selectTable").value) {
                alert("Please select a table before placing the order.");
                return;
            }

            if (cart.length === 0) {
                alert("Cart is empty!");
                return;
            }

            const tableNo = document.getElementById("selectTable").value;
            alert(`Order placed for Table ${tableNo}. Total: ${document.getElementById("totalAmount").innerText}`);
            cart = [];
            renderCart();
            document.getElementById("selectTable").value = "";
            document.getElementById("selectCategory").value = "All";
            document.querySelectorAll(".menu-item").forEach(item => item.style.display = "block");
        }
    </script>
}
